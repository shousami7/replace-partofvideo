# クリーンアップコマンド使用ガイド

`clean.sh`スクリプトは、`runs/`ディレクトリに溜まった動画処理セッションを効率的にクリーンアップするためのツールです。

## 基本的な使い方

### ヘルプを表示
```bash
./clean.sh -h
```

## 主な使用例

### 1. 最新のN個のセッションを残して古いものを削除（推奨）
```bash
# 最新の3つのセッションを残して、古いものを削除（確認あり）
./clean.sh -k 3

# 最新の5つのセッションを残して、古いものを削除（確認なし）
./clean.sh -k 5 -y
```

**使用シーン**: 定期的なメンテナンスに最適。ディスク容量を節約しながら、最近の作業は保持できます。

### 2. すべてのセッションを削除
```bash
# すべてのセッションを削除（確認あり）
./clean.sh -a

# すべてのセッションを削除（確認なし）
./clean.sh -a -y
```

**使用シーン**: プロジェクトを完全にリセットしたい場合や、大量のディスク容量を一気に解放したい場合。

### 3. 特定のセッションを削除
```bash
# 特定のセッションディレクトリを削除
./clean.sh -d runs/20251211_163422
```

**使用シーン**: 失敗したセッションや不要な特定のセッションだけを削除したい場合。

### 4. レガシーディレクトリのクリーンアップ
```bash
# tmp/ と output/ ディレクトリをクリーンアップ
./clean.sh
```

**使用シーン**: 古いバージョンのスクリプトで作成された一時ファイルを削除する場合。

## オプション一覧

| オプション | 説明 |
|----------|------|
| `-a` | `runs/`内のすべてのセッションを削除 |
| `-d DIR` | 特定のセッションディレクトリを削除 |
| `-k N` | 最新のN個のセッションを残して、古いものを削除 |
| `-y` | 確認プロンプトをスキップ（自動承認） |
| `-h` | ヘルプメッセージを表示 |

## 安全機能

1. **確認プロンプト**: デフォルトでは、削除前に確認を求めます（`-y`オプションでスキップ可能）
2. **削除対象の表示**: 削除されるセッションのリストを事前に表示します
3. **安全チェック**: ルートディレクトリやホームディレクトリでの実行を防止します
4. **`latest`シンボリックリンクの保護**: `-k`オプション使用時は`latest`リンクを保持します

## 推奨される運用方法

### 日常的なメンテナンス
```bash
# 週に1回、最新の5つのセッションを残してクリーンアップ
./clean.sh -k 5 -y
```

### プロジェクト完了後
```bash
# プロジェクト完了後、すべてクリーンアップ
./clean.sh -a
```

### ディスク容量が逼迫している場合
```bash
# 最新の1つだけ残して、残りを削除
./clean.sh -k 1
```

## トラブルシューティング

### セッション数を確認したい
```bash
ls -la runs/ | grep "^d" | wc -l
```

### 各セッションのサイズを確認したい
```bash
du -sh runs/*
```

### 削除をキャンセルしたい
確認プロンプトで`n`または`N`を入力するか、`Ctrl+C`で中断できます。

## 注意事項

- 削除されたセッションは復元できません
- 重要なセッションは事前にバックアップを取ることをお勧めします
- `-y`オプションは慎重に使用してください（確認なしで削除されます）
